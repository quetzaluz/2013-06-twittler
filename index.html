<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
	<script src="jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
	<link rel="stylesheet" type="text/css" href="index.css">
  </head>
  <body>
  <div id="streamTitle"></div>
  <div id="tweetBox"></div>
    <script>
      //functions to be called in interval
	  var stream;
	  
	  var showStream = function (stream) {
	    var index = stream.length - 1;
		var limit;
		if (stream == streams.home) limit = stream.length - 20;
		else limit = 0;
		var $body = $('body');
        var $tweetBox = $('#tweetBox');
        $tweetBox.html(''); 
		while(index > limit){
		  $tweetBox.css('height', $(window).height() - 50 + 'px');
          var tweet = stream[index];
		  var $tweet = $("<div class='tweet'></div>"); 
          var $tweetText = $('<div class = "tweetText"></div>');
          var $tweetTime = $('<div class = "tweetTime"></div>');
		  var $tweetUser = $("<button type='button' class = 'tweetUser' id = '"+ tweet.user+"'></a>");
		  $tweetUser.text("@" + tweet.user);
		  $tweetUser.val(tweet.user);
          $tweetText.text(": " + tweet.message);
          $tweetTime.text(jQuery.timeago(tweet.created_at));
		  $tweetUser.appendTo($tweet);
          $tweetText.appendTo($tweet);
          $tweetTime.appendTo($tweet);
		  $tweet.appendTo($tweetBox);
		  index -= 1;
		}
	  }

	  var setStream = function (thisUser) {
		//user, "home", or no arg to return source array val
		if (thisUser === "home") {
		  $('#streamTitle').text("Twittles on your Home Stream");
		  return stream = streams.home;
		  }
		else if (arguments.length === 0) {return stream;}
		else {
		  //this is where my problem is--steams.users is
		  //an object filled with other objects, not array.
		  for (var prop1 in streams.users) {
		    if (prop1 === thisUser && typeof streams.users[prop1] == "object") {
			   $('#streamTitle').text("Twittles on "+ thisUser +"'s stream")
			   return stream = streams.users[thisUser];
			}
		  }
		}
	  }

	  var getUser = function () {
	  var thisUser = $(this).val();
		 console.log("Clicked " + thisUser + ", trying setStream("+thisUser+")");
		 return setStream(thisUser);
	  }

      $(document).ready(function(){
	    $("abbr.timeago").timeago(); //attaching time func
		setStream("home");
        var intervalID = setInterval(function (){
		  showStream(setStream());
		}, 900);
		$('body').delegate('.tweetUser', 'click', getUser);
		$('body').delegate('#streamTitle', 'click', function () {setStream("home")})
	  }); 
	  		
    </script>
  </body>
</html>
